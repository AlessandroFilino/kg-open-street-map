#acces to psql database
psql -h postgres --username "admin" --port 5432

#per creare database
CREATE DATABASE name;

#Prima di lanciare gli script in osmosis, avvia il server in locale con:
service postgresql start


#CREAZIONE DI UNA VIEW CHE CONTENGA GLI ID DEI NODI CON ALMENO UN INCROCIO
CREATE OR REPLACE VIEW intersection_node AS
SELECT start_node
FROM extra_ways
GROUP BY start_node
HAVING COUNT(start_node) > 1
UNION
SELECT end_node
FROM extra_ways
GROUP BY end_node
HAVING COUNT(end_node) > 1;




Extra way nodi totali : 5957
Extra way incroci totali : 295
Extra way non incroci : 5662

select *
from extra_ways
where not exists ( select distinct way_id, sequence_id
from way_nodes
inner join intersection_node ON  way_nodes.node_id=intersection_node.prev_node_id
where way_id=global_id and sequence_id=local_id)




//per mettere i nodi in sequenza
create or replace view test as
select way_id,node_id,(row_number() over(partition by way_id order by sequence_id) -1)as sequence_id
from way_nodes;

select *
into tmp_db
from test;

delete from way_nodes;

insert into way_nodes
select*
from tmp_db;

drop table tmp_db;